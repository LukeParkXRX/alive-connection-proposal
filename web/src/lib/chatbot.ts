/**
 * í…ŒìŠ¤íŠ¸ ì±—ë´‡ â€” ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ìš© ìë™ ì‘ë‹µ
 * ë‚˜ì¤‘ì— ì‹¤ì œ LLM APIë¡œ êµì²´ ê°€ëŠ¥
 */

interface BotResponse {
  text: string;
  delayMs: number; // íƒ€ì´í•‘ ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„
}

/** ì¸ì‚¬/ì§ˆë¬¸ íŒ¨í„´ì— ë”°ë¥¸ ì‘ë‹µ ë§¤í•‘ */
const PATTERNS: [RegExp, string[]][] = [
  [/^(í•˜ì´|ì•ˆë…•|í—¬ë¡œ|hi|hello|hey)/i, [
    'ì•ˆë…•í•˜ì„¸ìš”! ALIVE í…ŒìŠ¤íŠ¸ ë´‡ì…ë‹ˆë‹¤ ğŸ‘‹',
    'ë°˜ê°‘ìŠµë‹ˆë‹¤! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
    'í•˜ì´! ì±„íŒ… í…ŒìŠ¤íŠ¸ ì¤‘ì´ì‹œêµ°ìš” ğŸ˜Š',
  ]],
  [/(ë­í•´|ë­í•˜|ë­˜í•´|what.*do)/i, [
    'ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ë¥¼ ë„ì™€ë“œë¦¬ê³  ìˆì–´ìš”!',
    'ë‹¹ì‹ ì˜ ì±„íŒ… ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤ ğŸ”§',
  ]],
  [/(í…ŒìŠ¤íŠ¸|test)/i, [
    'ì±„íŒ… í…ŒìŠ¤íŠ¸ê°€ ì˜ ì‘ë™í•˜ê³  ìˆë„¤ìš”! âœ…',
    'ë©”ì‹œì§€ ì „ì†¡, ì½ìŒ í™•ì¸ ëª¨ë‘ ì •ìƒì…ë‹ˆë‹¤.',
    'í…ŒìŠ¤íŠ¸ ì™„ë£Œ! íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°ë„ ë³´ì´ì‹œë‚˜ìš”?',
  ]],
  [/(ê¸°ëŠ¥|feature|ë­.*í• .*ìˆ˜)/i, [
    'í˜„ì¬ ì§€ì› ê¸°ëŠ¥:\nâ€¢ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡\nâ€¢ ì½ìŒ í™•ì¸ (âœ“âœ“)\nâ€¢ íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°\nâ€¢ ë¡œì»¬ ì €ì¥ (ì„œë²„ X)',
    'í…”ë ˆê·¸ë¨ ìŠ¤íƒ€ì¼ ë©”ì‹œì§•ì´ì—ìš”. ë©”ì‹œì§€ëŠ” ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.',
  ]],
  [/(ê³ ë§ˆì›Œ|ê°ì‚¬|thanks|thank)/i, [
    'ì²œë§Œì—ìš”! ë” í…ŒìŠ¤íŠ¸í•  ê²Œ ìˆìœ¼ë©´ ë§ì”€í•˜ì„¸ìš” ğŸ˜„',
    'ë³„ë§ì”€ì„ìš”! ì¦ê±°ìš´ í…ŒìŠ¤íŠ¸ ë˜ì„¸ìš” ğŸš€',
  ]],
  [/(ã…‹|ã…|lol|haha)/i, [
    'ã…‹ã…‹ã…‹ ì¬ë°Œìœ¼ì‹œì£ ?',
    'ã…ã… ì±„íŒ…ì´ ì˜ ë˜ëŠ” ê²ƒ ê°™ë„¤ìš”!',
  ]],
  [/(ë°”ì´|bye|ì˜ê°€|ë)/i, [
    'ì˜ê°€ìš”! ë‹¤ìŒì— ë˜ í…ŒìŠ¤íŠ¸í•´ìš” ğŸ‘‹',
    'ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ë°”ì´ë°”ì´~',
  ]],
];

/** ê¸°ë³¸ ì‘ë‹µ (ë§¤ì¹­ ì•ˆ ë  ë•Œ) */
const DEFAULT_RESPONSES = [
  (msg: string) => `"${msg}" â€” ë©”ì‹œì§€ ìˆ˜ì‹  í™•ì¸! ì±„íŒ… ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.`,
  () => 'ë©”ì‹œì§€ ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤! ë‹¤ë¥¸ ê²ƒë„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.',
  (msg: string) => `${msg.length}ì ë©”ì‹œì§€ë¥¼ ë°›ì•˜ì–´ìš”. ì „ì†¡ ì†ë„ëŠ” ì–´ë–¤ê°€ìš”?`,
  () => 'ì½ìŒ í‘œì‹œê°€ íŒŒë€ìƒ‰ìœ¼ë¡œ ë°”ë€Œì—ˆë‚˜ìš”? âœ“âœ“',
  () => 'ë¡œì»¬ ì €ì¥ì´ë¼ ìƒˆë¡œê³ ì¹¨í•´ë„ ëŒ€í™”ê°€ ìœ ì§€ë©ë‹ˆë‹¤. í•´ë³´ì„¸ìš”!',
];

/** ë©”ì‹œì§€ì— ëŒ€í•œ ë´‡ ì‘ë‹µ ìƒì„± */
export function generateBotResponse(userMessage: string): BotResponse {
  const trimmed = userMessage.trim();

  // íŒ¨í„´ ë§¤ì¹­
  for (const [pattern, responses] of PATTERNS) {
    if (pattern.test(trimmed)) {
      return {
        text: responses[Math.floor(Math.random() * responses.length)],
        delayMs: 800 + Math.random() * 1200, // 0.8~2ì´ˆ
      };
    }
  }

  // ê¸°ë³¸ ì‘ë‹µ
  const fn = DEFAULT_RESPONSES[Math.floor(Math.random() * DEFAULT_RESPONSES.length)];
  return {
    text: fn(trimmed),
    delayMs: 1000 + Math.random() * 1500, // 1~2.5ì´ˆ
  };
}

/** ë´‡ ì‚¬ìš©ì ID */
export const BOT_USER_ID = 'bot-demo-connection';
